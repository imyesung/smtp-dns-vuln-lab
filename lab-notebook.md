# Docker 기반 이메일 서버 취약점 실험 및 분석

## 프로젝트 개요

### 전체 목표

- Docker 환경을 기반으로 실험용 이메일 서버(Postfix, DNSMasq 등)를 구축한다.
- 이메일 서버 작동 원리를 SMTP, POP3, IMAP 수준까지 기초부터 정확히 이해한다.
- 구조적 취약점을 직접 실험하고, 공격 시나리오를 구성하며, 대응 방법까지 탐구한다.
- 최종적으로 '가상화 환경에서 실험 및 분석 완료' 보고서를 작성할 수 있도록 한다.

### 기본 전제

- 현재 이메일 서버에 대한 지식은 전무한 상태이다.
- 실험은 로컬 Docker 네트워크 내에서만 이루어진다.
- 외부 인터넷과 격리된 환경에서 모든 테스트를 수행한다.

## Part 1: Docker 기초 압축

### 1. Docker 기초 개념

**Docker는 왜 필요한가? 컨테이너와 VM의 핵심 차이는 무엇인가?**

- [x] Docker 기본 아키텍처 스터디

### 2. Docker 명령어 실습

**Docker에서 컨테이너를 생성하고 관리하는 기본 명령어는 무엇인가?**

- [x] `docker ps, run, stop, rm, images` 명령어 실습

### 3. Docker Compose 기본 구조

**여러 컨테이너를 관리할 때 Docker Compose는 어떻게 동작하는가?**

- [ ] 간단한 docker-compose.yml 구조 파악
- [x] `docker-compose up`, `docker-compose down` 명령어 실습

## Part 2: 이메일 서버 기초 심화

### 4. 이메일 시스템 기본 구조

**MTA, MDA, MUA는 각각 무엇이며, 어떤 역할을 하는가?**

- [x] 송신, 수신, 사용자 에이전트 흐름을 개념도와 함께 정리

### 5. SMTP 프로토콜 기초

**SMTP는 어떤 구조로 메일을 전송하는가? 주요 명령어는 무엇인가?**

- [ ] SMTP 명령어(HELO, MAIL FROM, RCPT TO, DATA) 학습
- [ ] telnet을 이용한 SMTP 명령어 실습

### 6. POP3와 IMAP 프로토콜 비교

**POP3와 IMAP은 어떤 차이가 있으며, 각각의 장단점은 무엇인가?**

- [ ] 두 프로토콜의 특징 비교
- [ ] 사용 포트(110, 143) 정리
- [ ] 각 프로토콜의 사용 흐름 정리

### 7. 이메일 서버 포트 번호 체계

**SMTP, SMTPS, Submission, POP3, IMAPS 등 각 프로토콜은 어떤 포트를 사용하는가?**

- [ ] 포트 번호 정리 (25, 465, 587, 110, 995, 143, 993)
- [ ] 각 포트별 용도와 보안 특성 표로 정리

### 8. 이메일 서버 통신 흐름 전체 요약

**메일이 송신되고 수신되기까지 전체 과정은 어떻게 흐르는가?**

- [x] 송신자 → SMTP 서버 → 수신자 메일 서버 → POP3/IMAP 사용자 흐름 요약

### 9. Postfix 기본 개념 심화

**Postfix는 SMTP 서버로서 어떤 내부 구조를 가지는가?**

- [ ] Postfix 프로세스(Postfix master, smtpd, pickup, qmgr 등) 흐름 정리

### 10. Postfix 주요 설정 파일(main.cf) 구조

**main.cf 파일에서 가장 중요한 설정 항목은 무엇인가?**
- [ ] `myhostname` 항목 분석
- [ ] `mydomain` 항목 분석
- [ ] `myorigin` 항목 분석
- [ ] `mydestination` 항목 분석
- [ ] `relayhost` 항목 분석
- [ ] `smtpd_recipient_restrictions` 항목 분석

### 11. DNSMasq 기본 개념 및 이메일 서버와의 관계

**DNSMasq는 왜 필요하며, 이메일 서버와 어떤 관계가 있는가?**

- [ ] DNSMasq의 DNS 재귀 질의 기능 학습
- [ ] SPF 레코드 질의와의 연관성 정리

## Part 3: 실험 환경 구축

### 12. Docker Compose로 이메일 서버 환경 구축

**Postfix와 DNSMasq를 연결하는 Docker Compose 파일은 어떻게 구성하는가?**

- [x] 기본 docker-compose.yml 작성
- [x] Docker 네트워크를 격리하기 위한 독립 bridge 네트워크 설정
- [ ] 또는 `--network none` 옵션 검토

### 13. Postfix 컨테이너 실행 및 초기 점검

**Postfix 컨테이너가 정상적으로 실행되었는지 어떻게 확인하는가?**

- [x] 컨테이너 로그 점검
- [ ] SMTP 포트 개방 상태 확인

### 14. DNSMasq 컨테이너 실행 및 점검

**DNSMasq 컨테이너에서 재귀 질의 허용 여부는 어떻게 확인하는가?**

- [ ] `dig` 명령어를 사용하여 외부 도메인 질의 테스트

### 15. SMTP 기본 통신 테스트

**telnet을 통해 SMTP 세션을 열고 기본 명령어를 수행하는 방법은 무엇인가?**

- [ ] `HELO` 명령어 테스트
- [ ] `MAIL FROM` 명령어 테스트
- [ ] `RCPT TO` 명령어 테스트
- [ ] `DATA` 명령어 테스트

### 16. 이메일 서버의 보안 기본 상태 점검

**기본 설치된 Postfix는 어떤 보안 기능(STARTTLS, 인증 등)을 활성화하고 있는가?**

- [ ] `openssl s_client`로 STARTTLS 지원 여부 점검
- [ ] 자체 서명 인증서나 만료 인증서 사용 시 발생하는 경고 관찰
- [ ] 보안 리스크 문서화

## Part 4: 전문 실험 및 분석

### 17. 오픈 릴레이 취약 구성 및 이해

**오픈 릴레이는 어떻게 구성되고, SMTP relay control 구조는 무엇인가?**

- [ ] `smtpd_recipient_restrictions` 설정을 `permit_mynetworks`로 구성

### 18. 오픈 릴레이 악용 가능성 실험

**인증 없이 메일 릴레이가 가능한지 어떻게 실험하는가?**

- [ ] telnet으로 인증 없는 RCPT TO 시도
- [ ] 릴레이 성공 여부 확인

### 19. DNS 재귀 질의 취약 구성 및 이해

**DNS 재귀 허용이 공격 벡터로 작동하는 구조는 무엇인가?**

- [ ] DNSMasq에서 재귀 질의 허용 설정 적용
- [ ] 재귀 질의 테스트

### 20. SPF 레코드 약화 설정 및 실험

**약한 SPF(~all) 레코드는 어떤 식으로 스푸핑 공격을 가능하게 하는가?**

- [ ] 약한 SPF 레코드 설정
- [ ] 외부 도메인 스푸핑 테스트

### 21. STARTTLS 미지원 환경 구성 및 실험

**STARTTLS 없이 SMTP 인증을 시도하면 어떤 위험이 발생하는가?**

- [ ] STARTTLS 미사용 설정
- [ ] 평문 인증 패킷 확인

### 22. SMTP 인증 평문 패킷 캡처 및 분석

**평문 SMTP 인증은 실제 패킷에 어떤 식으로 노출되는가?**

- [ ] Wireshark 또는 tcpdump로 AUTH PLAIN/LOGIN 패킷 캡처
- [ ] 캡처된 패킷 분석

### 23. 오픈 릴레이 스팸 릴레이 시뮬레이션

**오픈 릴레이를 이용해 제3자에게 스팸 메일을 보내는 경로를 어떻게 만들 수 있는가?**

- [ ] 외부 수신자 주소를 대상으로 릴레이 실험

### 24. DNS 증폭 공격 이론 실험

**재귀 DNS 서버를 이용한 증폭 공격은 어떤 메커니즘으로 작동하는가?**

- [ ] `dig ANY` 질의 등 대형 응답 유발 실험

### 25. 이메일 스푸핑 공격 시뮬레이션

**발신자 위조(From Spoofing)는 실제 이메일 헤더에 어떻게 반영되는가?**

- [ ] 위조된 MAIL FROM 사용
- [ ] 수신자 측 헤더 분석

### 26. 릴레이 서버 탐지 방법 연구

**외부에서 오픈 릴레이 서버를 탐지하는 일반적인 방법은 무엇인가?**

- [ ] nmap smtp-open-relay 스크립트 사용 실습
- [ ] OpenVAS, Metasploit의 이메일 모듈 사용 가능성 탐색

### 27. 취약 SMTP 서버 보안 강화 방법 연구

**smtpd_recipient_restrictions를 안전하게 구성하려면 어떻게 해야 하는가?**

- [ ] `permit_sasl_authenticated` 설정 적용
- [ ] `reject_unauth_destination` 설정 적용

### 28. DNSMasq 보안 강화 방법 연구

**DNSMasq에서 재귀 질의를 로컬 네트워크로만 제한하는 방법은 무엇인가?**

- [ ] `--local-service` 옵션 적용
- [ ] 제한 설정 테스트

### 29. SPF, DKIM, DMARC 인증 강화 방법 연구

**이메일 인증 체계를 강건하게 구성하는 방법은 무엇인가?**

- [ ] SPF `-all` 설정
- [ ] DKIM 키 생성 및 적용 흐름 요약
- [ ] DMARC 정책 설정 방법 정리

### 30. 종합 취약점 리스크 매핑

**발견된 취약점들을 위협모델링 관점에서 어떻게 정리할 수 있는가?**

- [ ] 취약점별 공격 시나리오 정리
- [ ] 각 취약점의 영향 분석
- [ ] 취약점별 대응 방안 표로 구성

### 31. 전체 실험 결과 요약 보고서 초안 작성

**보고서에 어떤 흐름으로 작성하면 자연스러운가?**

- [ ] 실험 목표 정리
- [ ] 환경 구축 내용 요약
- [ ] 발견된 취약점 목록화
- [ ] 대응 방안 흐름으로 초안 작성

### 32. 최종 정리 및 개인 메모 작성

**이번 실험을 통해 얻은 가장 중요한 교훈은 무엇인가?**

- [ ] 개인 메모로 실험 소회 정리

## 부록: 안전한 실험 환경 유지를 위한 지침

- 모든 테스트는 반드시 로컬 격리 환경에서만 수행한다.
- 실험 결과는 학술적, 교육적, 방어 전략 수립 목적으로만 사용한다.
- 네트워크 통제, 패킷 분석, 탐지 방지 등을 윤리적으로 검토한다.

